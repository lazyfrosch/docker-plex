#!/bin/bash

set -e

export PLEX_MEDIA_SERVER_MAX_PLUGIN_PROCS=6
export PLEX_MEDIA_SERVER_HOME=/usr/lib/plexmediaserver
export PLEX_MEDIA_SERVER_MAX_STACK_SIZE=3000
export PLEX_MEDIA_SERVER_TMPDIR=/tmp
export PLEX_MEDIA_SERVER_APPLICATION_SUPPORT_DIR="/plex"

test -d "$PLEX_MEDIA_SERVER_APPLICATION_SUPPORT_DIR" || mkdir -p "$PLEX_MEDIA_SERVER_APPLICATION_SUPPORT_DIR"

export LD_LIBRARY_PATH="${PLEX_MEDIA_SERVER_HOME}"
export TMPDIR="${PLEX_MEDIA_SERVER_TMPDIR}"

ulimit -s $PLEX_MAX_STACK_SIZE >/dev/null

cd /usr/lib/plexmediaserver

exec "./Plex Media Server" "$@"
